<script>
        // ==========================================
        // CONFIGURACI√ìN DE IRON√çA VERBAL (NIVEL LITERARIO)
        // ==========================================
        const POLLINATIONS_URL = "https://text.pollinations.ai/"; 
        
        let currentStyle = 'sarcasmo';

        // DEFINICIONES BASADAS EN TU TEXTO SOBRE IRON√çA VERBAL
        const PERSONAS = {
            sarcasmo: {
                label: "ESTILO: SARCASMO (The Onion)",
                tone: "Usa un tono cr√≠tico disfrazado de elogio o neutralidad. Di lo opuesto a lo que quieres dar a entender.",
                instruction: "T√âCNICA: Como en el discurso de Marco Antonio ('Brutus is an honorable man'), defiende lo indefendible. Elogia la incompetencia del sujeto (ej. gobierno, empresa, persona) trat√°ndola como una 'estrategia brillante' o una 'innovaci√≥n audaz'. No uses nombres tontos. Usa nombres institucionales reales para que la iron√≠a duela m√°s."
            },
            overstatement: {
                label: "ESTILO: EXAGERACI√ìN (Overstatement)",
                tone: "Dram√°tico, hiperb√≥lico, intenso.",
                instruction: "T√âCNICA: Toma un evento trivial (ej. tr√°fico, una fila, el clima) y el√©valo a tragedia griega o crisis hist√≥rica. Como Leslie Knope, usa una grandilocuencia absurda. Ejemplo: Un bache no es un bache, es 'una herida abierta en la corteza terrestre que exige sacrificios'."
            },
            understatement: {
                label: "ESTILO: SUBESTIMACI√ìN (Understatement)",
                tone: "Indiferente, burocr√°tico, calmado, c√≠nico.",
                instruction: "T√âCNICA: Minimiza lo horrible. Trata eventos catastr√≥ficos o problemas graves como si fueran molestias menores o tr√°mites aburridos. Ejemplo: Un apocalipsis zombie es solo 'un ligero aumento en la demanda de cerebros' o 'tr√°fico pesado en perif√©rico'."
            }
        };

        function selectStyle(style) {
            currentStyle = style;
            document.querySelectorAll('.style-card').forEach(el => el.classList.remove('selected'));
            document.getElementById(`style-${style}`).classList.add('selected');
        }

        async function generateContent() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) return alert("El silencio tambi√©n es ir√≥nico, pero necesito un tema.");

            const btn = document.getElementById('generateBtn');
            const originalBtnText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-pulse">üñãÔ∏è REDACTANDO...</span>';
            
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('resultState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');

            try {
                await callIroniusAI(topic);
            } catch (error) {
                console.error("Error:", error);
                alert("La realidad super√≥ a la ficci√≥n. Error de conexi√≥n.");
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalBtnText;
            }
        }

        async function callIroniusAI(topic) {
            const persona = PERSONAS[currentStyle];
            document.getElementById('sectionLabel').innerText = persona.label;

            // PROMPT REFINADO: CERO PAYASADAS, 100% DEADPAN
            const systemPrompt = `
                Act√∫a como un periodista de un medio sat√≠rico de alto nivel (como The Onion o El Mundo Today).
                
                TEMA: "${topic}".
                ESTILO APLICADO: ${persona.tone}
                INSTRUCCI√ìN CLAVE: ${persona.instruction}

                REGLAS DE ORO (VERBAL IRONY):
                1. MANT√âN EL PERSONAJE (DEADPAN): Nunca expliques el chiste. Nunca digas "esto es iron√≠a". Nunca digas "jaja". Escribe con la seriedad de un peri√≥dico financiero.
                2. NOMBRES REALISTAS: No inventes "Instituto de Tontadas". Usa "Secretar√≠a de Hacienda", "La ONU", "Vecinos de la Colonia", etc. La iron√≠a surge de que una instituci√≥n "seria" haga algo absurdo.
                3. SUTILEZA: Deja que el lector entienda el doble sentido.
                
                Debes responder √öNICAMENTE con este JSON (sin texto extra):
                {
                    "headline": "Titular serio pero con contenido absurdo",
                    "subtitle": "Bajada period√≠stica que profundiza la iron√≠a",
                    "location": "Lugar Real (CDMX, Madrid, Buenos Aires...)",
                    "author": "Nombre normal (ej. 'Roberto D√≠az', 'Redacci√≥n')",
                    "body": [
                        {"type": "p", "content": "Lead period√≠stico serio estableciendo la premisa absurda como un hecho real."},
                        {"type": "p", "content": "Contexto o datos (usa la t√©cnica de ${currentStyle} aqu√≠)."},
                        {"type": "quote", "speaker": "Nombre Normal", "role": "Cargo Realista (ej. Vocero, Ciudadano)", "text": "Cita textual que confirme el absurdo con total seriedad."},
                        {"type": "p", "content": "Cierre seco o c√≠nico."}
                    ]
                }
            `.trim();

            const seed = Math.floor(Math.random() * 1000000);
            
            const response = await fetch(POLLINATIONS_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: `Escribe la noticia sobre ${topic}.` }
                    ],
                    model: "openai", 
                    seed: seed
                })
            });

            if (!response.ok) throw new Error(`Error API: ${response.status}`);
            
            const textResponse = await response.text();
            
            let cleanJson;
            try {
                const firstBracket = textResponse.indexOf('{');
                const lastBracket = textResponse.lastIndexOf('}');
                if (firstBracket !== -1 && lastBracket !== -1) {
                    cleanJson = JSON.parse(textResponse.substring(firstBracket, lastBracket + 1));
                } else {
                    throw new Error("JSON no encontrado");
                }
            } catch (e) {
                // Fallback de emergencia si la IA falla
                cleanJson = {
                    headline: "La realidad se niega a colaborar",
                    subtitle: "Nuestros periodistas no encontraron iron√≠a hoy.",
                    location: "M√âXICO",
                    author: "Redacci√≥n",
                    body: [
                        {type: "p", content: "Hubo un error t√©cnico al generar la s√°tira. Por favor intenta con otro tema."},
                        {type: "quote", speaker: "Sistema", role: "Servidor", text: "404: Humor not found."}
                    ]
                };
            }

            renderNews(cleanJson);
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('resultState').classList.remove('hidden');
        }

        function renderNews(data) {
            document.getElementById('resultTitle').innerText = data.headline || "";
            document.getElementById('resultSubtitle').innerText = data.subtitle || "";
            document.getElementById('resultLocation').innerText = (data.location || "M√âXICO").toUpperCase();
            document.getElementById('resultAuthor').innerText = (data.author || "REDACCI√ìN").toUpperCase();

            const container = document.getElementById('resultContent');
            container.innerHTML = '';
            
            if (data.body && Array.isArray(data.body)) {
                data.body.forEach((block, index) => {
                    if (block.type === 'quote') {
                        container.innerHTML += `
                            <div class="my-8 relative pl-6 border-l-4 border-black py-2 bg-gray-50">
                                <p class="font-headline text-2xl text-black font-bold mb-2 italic leading-tight">
                                    "${block.text}"
                                </p>
                                <p class="font-mono text-xs text-gray-600 uppercase tracking-widest mt-2">
                                    ‚Äî ${block.speaker}, <span class="font-bold">${block.role}</span>
                                </p>
                            </div>
                        `;
                    } else {
                        const dropCapClass = index === 0 ? "drop-cap" : "";
                        container.innerHTML += `
                            <p class="${dropCapClass} mb-6 text-gray-900 font-body text-lg leading-relaxed text-justify">
                                ${block.content}
                            </p>
                        `;
                    }
                });
            }
        }
    </script>
