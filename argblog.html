<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ARG - El Archivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Poppins:wght@200;300;400&display=swap" rel="stylesheet">
    <style>
        /* --- ESTÉTICA GENERAL --- */
        body {
            background-color: #050505;
            color: #e5e5e5;
            font-family: 'Poppins', sans-serif;
            overflow: hidden; /* Importante: evitamos el scroll nativo del body */
            cursor: none; /* Ocultamos cursor nativo para usar el custom */
        }

        /* Tipografía */
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .font-sans { font-family: 'Poppins', sans-serif; }

        /* Scrollbar oculta para la galería */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* Efecto Vidrio (Glassmorphism) */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease-out;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        /* Cursores Personalizados */
        #cursor-dot, #cursor-outline {
            position: fixed;
            top: 0;
            left: 0;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none;
        }
        #cursor-dot { width: 8px; height: 8px; background-color: white; }
        #cursor-outline {
            width: 40px; height: 40px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: width 0.2s, height 0.2s, background-color 0.2s;
        }
        
        /* Estado Hover del Cursor */
        body.hovering #cursor-outline {
            width: 60px; height: 60px;
            background-color: rgba(255, 255, 255, 0.1);
            border-color: white;
            backdrop-filter: blur(2px);
        }

        /* Animación de carga */
        .loader-line {
            width: 0%; height: 1px; background: white;
            animation: load 2s ease-in-out infinite;
        }
        @keyframes load { 0% { width: 0%; opacity: 0; } 50% { width: 100%; opacity: 1; } 100% { width: 0%; right: 0; opacity: 0; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <div id="cursor-dot"></div>
    <div id="cursor-outline"></div>

    <script>
        // Lógica simple del cursor fuera de React para rendimiento
        const dot = document.getElementById('cursor-dot');
        const outline = document.getElementById('cursor-outline');
        window.addEventListener('mousemove', (e) => {
            dot.style.left = e.clientX + 'px';
            dot.style.top = e.clientY + 'px';
            
            // Un poco de lag para el círculo exterior (efecto fluido)
            outline.animate({
                left: e.clientX + 'px',
                top: e.clientY + 'px'
            }, { duration: 500, fill: "forwards" });
        });
    </script>

    <script type="module">
        import React from 'https://esm.sh/react@18.3.1';
        import ReactDOM from 'https://esm.sh/react-dom@18.3.1/client';

        const { useRef, useEffect, useState } = React;

        // --- ASSETS ---
        const BG_DARK = 'https://res.cloudinary.com/dahrwkdzd/image/upload/v1759380713/arg01_ft9glg.png';
        const BG_REVEAL = 'https://res.cloudinary.com/dahrwkdzd/image/upload/v1759380719/arg02_o9yqpm.png';

        // --- COMPONENTE: MODAL LECTURA ---
        const PostModal = ({ post, onClose }) => {
            useEffect(() => {
                const handleEsc = (e) => e.key === 'Escape' && onClose();
                window.addEventListener('keydown', handleEsc);
                return () => window.removeEventListener('keydown', handleEsc);
            }, [onClose]);

            if (!post) return null;

            return React.createElement('div', {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm transition-all duration-500 animate-fadeIn",
                onClick: (e) => e.target === e.currentTarget && onClose()
            },
                React.createElement('div', {
                    className: "w-full h-full md:max-w-4xl md:h-[90vh] bg-[#0a0a0a] md:border md:border-white/10 md:rounded-lg overflow-y-auto relative flex flex-col"
                },
                    // Imagen Hero
                    post.image && React.createElement('div', { 
                        className: "w-full h-64 md:h-80 bg-cover bg-center shrink-0 relative",
                        style: { backgroundImage: `url(${post.image})` }
                    },
                        React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-[#0a0a0a] to-transparent" })
                    ),
                    
                    // Contenido
                    React.createElement('div', { className: "p-8 md:p-12 max-w-2xl mx-auto w-full" },
                        React.createElement('button', { 
                            onClick: onClose,
                            className: "mb-8 text-xs tracking-[0.2em] text-gray-400 hover:text-white transition-colors uppercase"
                        }, "← Volver al Archivo"),

                        React.createElement('h1', { className: "font-serif text-4xl md:text-5xl mb-4 text-white leading-tight" }, post.title),
                        
                        React.createElement('div', { className: "flex gap-4 mb-12 border-b border-white/10 pb-4" },
                            React.createElement('span', { className: "text-xs font-mono text-gray-500" }, post.date || "FECHA DESCONOCIDA"),
                            post.tags && post.tags.map(t => React.createElement('span', { key: t, className: "text-xs font-mono text-white/60" }, `#${t}`))
                        ),

                        React.createElement('div', { className: "prose prose-invert prose-lg font-light text-gray-300 leading-loose" },
                            post.content.split('\n').map((p, i) => 
                                p.trim() && React.createElement('p', { key: i, className: "mb-6" }, p)
                            )
                        )
                    )
                )
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const revealedLayerRef = useRef(null);
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedPost, setSelectedPost] = useState(null);

            // 1. EFECTO FÍSICA (LINTERNA)
            useEffect(() => {
                const isMobile = window.matchMedia("(max-width: 768px)").matches;
                const TRAIL_LENGTH = isMobile ? 5 : 8; 
                const BASE_RADIUS = isMobile ? 120 : 180;
                
                const points = Array(TRAIL_LENGTH).fill({ x: window.innerWidth / 2, y: window.innerHeight / 2 });
                let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };

                const handleMove = (e) => {
                    mouse = { 
                        x: e.touches ? e.touches[0].clientX : e.clientX, 
                        y: e.touches ? e.touches[0].clientY : e.clientY 
                    };
                };

                window.addEventListener('mousemove', handleMove);
                window.addEventListener('touchmove', handleMove);

                let animationFrameId;
                const loop = () => {
                    // Física del rastro (Leader-Follower)
                    points[0].x += (mouse.x - points[0].x) * 0.15;
                    points[0].y += (mouse.y - points[0].y) * 0.15;

                    for (let i = 1; i < TRAIL_LENGTH; i++) {
                        points[i].x += (points[i-1].x - points[i].x) * 0.25;
                        points[i].y += (points[i-1].y - points[i].y) * 0.25;
                    }

                    if (revealedLayerRef.current) {
                        const gradients = points.map((p, i) => {
                            const size = BASE_RADIUS * (1 - (i / TRAIL_LENGTH) * 0.6);
                            return `radial-gradient(circle ${size}px at ${p.x}px ${p.y}px, black 100%, transparent 100%)`;
                        });
                        const mask = gradients.join(', ');
                        revealedLayerRef.current.style.maskImage = mask;
                        revealedLayerRef.current.style.webkitMaskImage = mask;
                    }
                    animationFrameId = requestAnimationFrame(loop);
                };
                loop();

                return () => {
                    window.removeEventListener('mousemove', handleMove);
                    window.removeEventListener('touchmove', handleMove);
                    cancelAnimationFrame(animationFrameId);
                };
            }, []);

            // 2. CARGAR DATOS
            useEffect(() => {
                const load = async () => {
                    try {
                        const res = await fetch(`https://api.github.com/repos/alter-ias/argblog-datos/issues?labels=blog-post&state=open`);
                        const data = await res.json();
                        const validPosts = data.map(issue => {
                            try { return { ...JSON.parse(issue.body), createdAt: issue.created_at }; } 
                            catch { return null; }
                        }).filter(Boolean).sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
                        setPosts(validPosts);
                    } catch (e) { console.error(e); } 
                    finally { setLoading(false); }
                };
                load();
            }, []);

            // Handlers para cursores
            const hoverStart = () => document.body.classList.add('hovering');
            const hoverEnd = () => document.body.classList.remove('hovering');

            return React.createElement(React.Fragment, null,
                
                // --- FONDO INTERACTIVO (Detrás de todo) ---
                React.createElement('div', { className: "fixed inset-0 z-0 pointer-events-none" },
                    React.createElement('div', { 
                        className: "absolute inset-0 bg-cover bg-center opacity-40 grayscale contrast-125",
                        style: { backgroundImage: `url(${BG_DARK})` } 
                    }),
                    React.createElement('div', {
                        ref: revealedLayerRef,
                        className: "absolute inset-0 bg-cover bg-center",
                        style: { backgroundImage: `url(${BG_REVEAL})`, maskImage: 'none' } // La máscara se aplica por JS
                    })
                ),

                // --- UI SUPERIOR (Fija) ---
                React.createElement('nav', { className: "fixed top-0 left-0 w-full p-8 z-30 flex justify-between items-start pointer-events-none" },
                    React.createElement('div', { className: "pointer-events-auto" },
                        React.createElement('a', { 
                            href: "https://alter-ias.github.io/arg/argx.html",
                            className: "font-serif text-4xl text-white tracking-widest mix-blend-difference hover:opacity-70 transition-opacity",
                            onMouseEnter: hoverStart, onMouseLeave: hoverEnd
                        }, "ARG")
                    ),
                    React.createElement('div', { className: "text-right hidden md:block mix-blend-overlay opacity-50" },
                        React.createElement('p', { className: "text-xs tracking-widest" }, "SISTEMA DE ARCHIVO v2.4"),
                        React.createElement('p', { className: "text-xs tracking-widest" }, "ESTADO: ONLINE")
                    )
                ),

                // --- ÁREA DE CONTENIDO PRINCIPAL (Galería Horizontal) ---
                React.createElement('main', { className: "fixed inset-0 z-20 flex flex-col justify-end pb-12 md:pb-24 pointer-events-none" },
                    
                    loading ? 
                        React.createElement('div', { className: "w-full flex flex-col items-center justify-center mb-32" },
                            React.createElement('div', { className: "w-24 h-px bg-white/20 relative" },
                                React.createElement('div', { className: "absolute top-0 left-0 h-full bg-white loader-line" })
                            ),
                            React.createElement('p', { className: "mt-4 text-xs tracking-widest text-gray-500 animate-pulse" }, "DESCIFRANDO DATOS...")
                        ) 
                    :
                        React.createElement('div', { className: "w-full pointer-events-auto pl-8 md:pl-24" },
                            React.createElement('h2', { className: "text-xs font-mono text-gray-400 mb-6 tracking-[0.3em] uppercase ml-1" }, "Entradas Recientes"),
                            
                            // CONTENEDOR DE SCROLL HORIZONTAL
                            React.createElement('div', { className: "flex gap-6 overflow-x-auto hide-scroll pr-24 pb-10 items-end" },
                                posts.map((post, idx) => 
                                    React.createElement('div', {
                                        key: idx,
                                        onClick: () => setSelectedPost(post),
                                        onMouseEnter: hoverStart,
                                        onMouseLeave: hoverEnd,
                                        className: "glass-card shrink-0 w-[280px] h-[350px] md:w-[320px] md:h-[420px] rounded-sm p-6 flex flex-col justify-end relative overflow-hidden group cursor-none select-none"
                                    },
                                        // Imagen de fondo de la tarjeta (se revela sutilmente al hover)
                                        post.image && React.createElement('div', {
                                            className: "absolute inset-0 bg-cover bg-center transition-all duration-700 opacity-20 group-hover:opacity-60 group-hover:scale-110 grayscale group-hover:grayscale-0",
                                            style: { backgroundImage: `url(${post.image})` }
                                        }),
                                        // Gradiente para texto
                                        React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-80" }),

                                        // Contenido Tarjeta
                                        React.createElement('div', { className: "relative z-10 transform translate-y-2 group-hover:translate-y-0 transition-transform duration-500" },
                                            React.createElement('span', { className: "text-[10px] font-mono border border-white/20 px-2 py-1 rounded-full text-gray-400 mb-3 inline-block" }, 
                                                post.date || "N/A"
                                            ),
                                            React.createElement('h3', { className: "font-serif text-2xl md:text-3xl text-gray-100 leading-none mb-2 group-hover:text-white" }, post.title),
                                            React.createElement('p', { className: "text-xs text-gray-500 line-clamp-2 font-light opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-100" }, post.excerpt)
                                        ),

                                        // Decoración esquina
                                        React.createElement('div', { className: "absolute top-4 right-4 text-[10px] font-mono text-white/20" }, `0${idx + 1}`)
                                    )
                                )
                            )
                        )
                ),

                // --- MODAL ---
                selectedPost && React.createElement(PostModal, { post: selectedPost, onClose: () => setSelectedPost(null) })
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App, null));
    </script>
</body>
</html>
