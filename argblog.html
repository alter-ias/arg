<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>El Archivo - ARG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Poppins:wght@300;400&display=swap" rel="stylesheet">
    <style>
        /* --- ESTILOS BASE Y CURSORES (Fuente 1) --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #0a0a0a;
            color: #FFFFFF;
            font-family: 'Poppins', sans-serif;
            -webkit-font-smoothing: antialiased;
            /* Cursor base */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg>'), auto;
        }

        /* Estilos de Scrollbar minimalista */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .font-sans { font-family: 'Poppins', sans-serif; }

        /* Cursores interactivos */
        .interactive-hover:hover {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg>'), auto;
        }

        /* Animación de carga */
        .spinner {
            border: 4px solid rgba(255,255,255, 0.2);
            border-left-color: #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Clases utilitarias para el contenido del blog */
        .glass-panel {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React from 'https://esm.sh/react@18.3.1';
        import ReactDOM from 'https://esm.sh/react-dom@18.3.1/client';

        const { useRef, useEffect, useState } = React;

        // --- IMÁGENES DE FONDO (Fuente 1) ---
        const BG_DARK = 'https://res.cloudinary.com/dahrwkdzd/image/upload/v1759380713/arg01_ft9glg.png';
        const BG_REVEAL = 'https://res.cloudinary.com/dahrwkdzd/image/upload/v1759380719/arg02_o9yqpm.png';

        // --- COMPONENTE: MODAL DE POST (Lógica de lectura) ---
        const PostModal = ({ post, onClose }) => {
            if (!post) return null;

            useEffect(() => {
                const handleEsc = (e) => e.key === 'Escape' && onClose();
                window.addEventListener('keydown', handleEsc);
                document.body.style.overflow = 'hidden'; // Bloquear scroll del body
                return () => {
                    window.removeEventListener('keydown', handleEsc);
                    document.body.style.overflow = '';
                };
            }, [onClose]);

            // Parsear contenido simple (saltos de línea a párrafos)
            const contentParagraphs = post.content.split('\n').filter(p => p.trim() !== '');

            return React.createElement('div', {
                className: "fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 transition-opacity duration-300",
                onClick: (e) => e.target === e.currentTarget && onClose()
            },
                React.createElement('div', {
                    className: "relative w-full max-w-4xl max-h-[90vh] overflow-y-auto glass-panel rounded-xl p-8 md:p-12 interactive-hover"
                },
                    // Botón Cerrar
                    React.createElement('button', {
                        onClick: onClose,
                        className: "absolute top-4 right-6 text-4xl font-serif text-white/70 hover:text-white hover:scale-110 transition-all"
                    }, "×"),

                    // Header del Post
                    React.createElement('h2', { className: "font-serif text-4xl md:text-5xl mb-4 leading-tight text-white" }, post.title),
                    React.createElement('div', { className: "flex gap-4 text-sm text-gray-400 mb-8 font-sans uppercase tracking-widest" },
                        React.createElement('span', null, post.date || new Date(post.createdAt).toLocaleDateString('es-ES')),
                        post.tags && post.tags.map(tag => React.createElement('span', { key: tag, className: "border border-white/20 px-2 rounded-full" }, tag))
                    ),

                    // Imagen Principal
                    post.image && React.createElement('img', {
                        src: post.image,
                        alt: post.title,
                        className: "w-full h-64 md:h-96 object-cover rounded-lg mb-8 opacity-90"
                    }),

                    // Cuerpo del texto
                    React.createElement('div', { className: "prose prose-invert prose-lg max-w-none font-sans font-light leading-relaxed text-gray-200" },
                        contentParagraphs.map((p, idx) => React.createElement('p', { key: idx, className: "mb-6" }, p))
                    )
                )
            );
        };

        // --- COMPONENTE PRINCIPAL ---
        const App = () => {
            const revealedLayerRef = useRef(null);
            
            // Estado para el blog
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedPost, setSelectedPost] = useState(null);
            const [filter, setFilter] = useState('all');

            // --- LÓGICA DE FÍSICA / BACKGROUND (Fuente 1) ---
            const isMobile = window.matchMedia("(max-width: 768px)").matches;
            const TRAIL_LENGTH = isMobile ? 5 : 8; 
            const BASE_RADIUS = isMobile ? 150 : 220; // Ligeramente más grande para leer mejor
            
            const points = useRef(Array(TRAIL_LENGTH).fill({ x: window.innerWidth / 2, y: window.innerHeight / 2 }));
            const mouse = useRef({ x: window.innerWidth / 2, y: window.innerHeight / 2 });

            useEffect(() => {
                const handleMove = (e) => {
                    let clientX, clientY;
                    if (e.touches && e.touches.length > 0) {
                        clientX = e.touches[0].clientX;
                        clientY = e.touches[0].clientY;
                    } else {
                        clientX = e.clientX;
                        clientY = e.clientY;
                    }
                    mouse.current = { x: clientX, y: clientY };
                };

                window.addEventListener('mousemove', handleMove);
                window.addEventListener('touchstart', handleMove, { passive: false });
                window.addEventListener('touchmove', handleMove, { passive: false });

                let animationFrameId;

                const loop = () => {
                    const currentPoints = [...points.current];
                    const leaderEasing = 0.15;
                    // Líder sigue al mouse
                    currentPoints[0] = {
                        x: currentPoints[0].x + (mouse.current.x - currentPoints[0].x) * leaderEasing,
                        y: currentPoints[0].y + (mouse.current.y - currentPoints[0].y) * leaderEasing
                    };

                    const trailEasing = 0.25; 
                    for (let i = 1; i < TRAIL_LENGTH; i++) {
                        const leader = currentPoints[i - 1];
                        const follower = currentPoints[i];
                        currentPoints[i] = {
                            x: follower.x + (leader.x - follower.x) * trailEasing,
                            y: follower.y + (leader.y - follower.y) * trailEasing
                        };
                    }
                    
                    points.current = currentPoints;

                    if (revealedLayerRef.current) {
                        const gradients = currentPoints.map((p, i) => {
                            const scale = 1 - (i / TRAIL_LENGTH) * 0.6;
                            const radius = BASE_RADIUS * scale;
                            return `radial-gradient(circle ${radius}px at ${p.x}px ${p.y}px, black 100%, transparent 100%)`;
                        });
                        
                        const maskString = gradients.join(', ');
                        
                        // Aplicar máscara para revelar la capa "Light"
                        revealedLayerRef.current.style.maskImage = maskString;
                        revealedLayerRef.current.style.webkitMaskImage = maskString;
                    }
                    
                    animationFrameId = requestAnimationFrame(loop);
                };
                
                loop();

                return () => {
                    window.removeEventListener('mousemove', handleMove);
                    window.removeEventListener('touchstart', handleMove);
                    window.removeEventListener('touchmove', handleMove);
                    cancelAnimationFrame(animationFrameId);
                };
            }, [isMobile]);

            // --- LÓGICA DE DATOS (Fuente 2 - API GitHub) ---
            useEffect(() => {
                const fetchPosts = async () => {
                    try {
                        const response = await fetch(`https://api.github.com/repos/alter-ias/argblog-datos/issues?labels=blog-post&state=open`);
                        if (!response.ok) throw new Error('Error al cargar');
                        const issues = await response.json();
                        
                        const parsedPosts = issues.map(issue => {
                            try {
                                return { ...JSON.parse(issue.body), createdAt: issue.created_at };
                            } catch (e) { return null; }
                        }).filter(p => p !== null);

                        // Ordenar por fecha
                        parsedPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        setPosts(parsedPosts);
                    } catch (error) {
                        console.error(error);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchPosts();
            }, []);

            // Filtrado
            const allTags = [...new Set(posts.flatMap(p => p.tags || []))];
            const filteredPosts = filter === 'all' ? posts : posts.filter(p => p.tags && p.tags.includes(filter));

            // --- RENDER ---
            return React.createElement(React.Fragment, null,
                
                // 1. CAPA DE FONDO (OSCURA/ESTÁTICA)
                React.createElement('div', { 
                    className: "fixed inset-0 z-0 bg-cover bg-center", 
                    style: { backgroundImage: `url(${BG_DARK})` } 
                }),

                // 2. CAPA REVELADA (LUZ/MÁSCARA) - Funciona solo visualmente detrás del contenido
                React.createElement('div', {
                    ref: revealedLayerRef,
                    className: "fixed inset-0 z-10 bg-cover bg-center pointer-events-none",
                    style: { 
                        backgroundImage: `url(${BG_REVEAL})`,
                        WebkitMaskImage: 'none',
                        maskImage: 'none',
                    }
                }),

                // 3. CAPA DE CONTENIDO (SCROLLABLE - Z-INDEX ALTO)
                React.createElement('div', { className: "relative z-20 w-full min-h-screen flex flex-col items-center" },
                    
                    // HEADER
                    React.createElement('header', { className: "w-full p-8 flex justify-center items-center mt-8 mb-12" },
                        React.createElement('a', { 
                            href: "https://alter-ias.github.io/arg/argx.html", 
                            className: "font-serif text-5xl font-bold text-white tracking-widest hover:scale-105 transition-transform interactive-hover" 
                        }, "ARG")
                    ),

                    // FRASE HERO
                    React.createElement('div', { className: "text-center max-w-2xl px-6 mb-16" },
                        React.createElement('p', { className: "font-serif text-2xl md:text-3xl italic text-gray-300" },
                            "\"La ilustración necesita encarnarse para que la verdad sea otra vez una excitante insinuación\""
                        )
                    ),

                    // FILTROS
                    !loading && React.createElement('div', { className: "flex flex-wrap justify-center gap-3 mb-12 px-4" },
                        React.createElement('button', {
                            onClick: () => setFilter('all'),
                            className: `px-4 py-1 rounded-full border transition-all text-sm uppercase tracking-wide interactive-hover ${filter === 'all' ? 'bg-white text-black border-white' : 'bg-transparent text-gray-400 border-gray-600 hover:border-white hover:text-white'}`
                        }, "Todos"),
                        allTags.map(tag => 
                            React.createElement('button', {
                                key: tag,
                                onClick: () => setFilter(tag),
                                className: `px-4 py-1 rounded-full border transition-all text-sm uppercase tracking-wide interactive-hover ${filter === tag ? 'bg-white text-black border-white' : 'bg-transparent text-gray-400 border-gray-600 hover:border-white hover:text-white'}`
                            }, tag)
                        )
                    ),

                    // GRID DE POSTS
                    React.createElement('div', { className: "w-full max-w-4xl px-6 pb-24 grid grid-cols-1 gap-16" },
                        loading ? 
                            React.createElement('div', { className: "flex flex-col items-center justify-center py-20" },
                                React.createElement('div', { className: "spinner mb-4" }),
                                React.createElement('p', { className: "text-gray-400" }, "Recuperando archivos...")
                            ) :
                            filteredPosts.map((post, index) => 
                                React.createElement('div', { 
                                    key: index, 
                                    className: "flex flex-col items-center text-center group" 
                                },
                                    // Título
                                    React.createElement('h2', { className: "font-serif text-4xl md:text-5xl mb-4 text-white group-hover:text-gray-200 transition-colors" }, post.title),
                                    
                                    // Imagen (Efecto ventana simple)
                                    React.createElement('div', { 
                                        className: "w-full h-64 md:h-80 overflow-hidden rounded-sm mb-6 border border-white/10 relative cursor-pointer interactive-hover",
                                        onClick: () => setSelectedPost(post)
                                    },
                                        post.image ? 
                                            React.createElement('img', { 
                                                src: post.image, 
                                                alt: post.title, 
                                                className: "w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700 opacity-80 group-hover:opacity-100" 
                                            }) : 
                                            React.createElement('div', { className: "w-full h-full bg-gray-900 flex items-center justify-center text-gray-600" }, "Sin imagen")
                                    ),

                                    // Meta info
                                    React.createElement('div', { className: "text-gray-400 text-sm mb-4 font-sans tracking-wider" }, 
                                        post.date || new Date(post.createdAt).toLocaleDateString('es-ES')
                                    ),

                                    // Extracto
                                    React.createElement('p', { className: "text-gray-300 max-w-2xl mb-6 font-light leading-relaxed" }, post.excerpt),

                                    // Botón Leer más
                                    React.createElement('button', {
                                        onClick: () => setSelectedPost(post),
                                        className: "border border-white/40 text-white px-8 py-2 rounded-full uppercase text-xs tracking-widest hover:bg-white hover:text-black transition-all interactive-hover"
                                    }, "Leer Entrada")
                                )
                            )
                    )
                ),

                // 4. MODAL
                selectedPost && React.createElement(PostModal, { post: selectedPost, onClose: () => setSelectedPost(null) })
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App, null));
    </script>
</body>
</html>
