<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARG - Jardín Digital (Sistema Modular Final)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Poppins:wght@300;400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --main-gap: 2rem;
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Poppins', sans-serif;
            --color-light: #f8f9fa;
        }

        /* Estilos base (tu estética) */
        * { box-sizing: border-box; }
        body { margin: 0; font-family: var(--font-sans); color: var(--color-light); background-color: #1a1a1a; overflow-x: hidden; }
        header { padding: 1.5rem var(--main-gap); position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; mix-blend-mode: exclusion; }
        .header-logo a { font-family: var(--font-serif); font-size: 2.5rem; font-weight: 700; text-decoration: none; color: var(--color-light); }
        .media-block { position: relative; width: 100%; height: 80vh; overflow: hidden; display: flex; align-items: center; justify-content: center; text-align: center; }
        #block-1 { height: 100vh; }
        .background-media { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; overflow: hidden; }
        .background-media img, .background-media video { width: 100%; height: 130%; object-fit: cover; will-change: transform; }
        .media-block::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); z-index: 2; }
        
        /* Sistema de Overlays Modular */
        .color-overlay { position: absolute; z-index: 3; }
        .overlay-full { width: 100%; height: 100%; opacity: 0.6; }
        .overlay-half-right { top: 0; right: 0; width: 50%; height: 100%; }
        .overlay-window { width: 100%; height: 100%; padding: 3rem; opacity: 0.8; }
        @keyframes gradient-horizontal { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes gradient-vertical { 0% { background-position: 50% 0%; } 50% { background-position: 50% 100%; } 100% { background-position: 50% 0%; } }
        .iridescent-base { background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); background-size: 400% 400%; }
        .iridescent-slow-h { animation: gradient-horizontal 25s ease infinite; }
        .iridescent-medium-h { animation: gradient-horizontal 15s ease infinite; }
        .iridescent-fast-v { animation: gradient-vertical 8s ease infinite; }

        /* Estilos de contenido y responsive */
        .content-overlay { position: relative; z-index: 4; padding: var(--main-gap); max-width: 800px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; }
        .media-block.is-visible .content-overlay { opacity: 1; transform: translateY(0); }
        .content-overlay h1, .content-overlay h2 { font-family: var(--font-serif); font-weight: 600; line-height: 1.1; margin: 0 0 1rem 0; }
        .content-overlay h1 { font-size: 5rem; } .content-overlay h2 { font-size: 4rem; }
        .content-overlay p { font-size: 1.2rem; max-width: 600px; margin: 0 auto 1.5rem auto; }
        .btn { display: inline-block; padding: 0.8rem 1.8rem; border: 2px solid var(--color-light); color: var(--color-light); background-color: transparent; text-decoration: none; transition: background-color 0.3s, color 0.3s; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; border-radius: 50px; }
        .btn:hover { background-color: var(--color-light); color: #1a1a1a; }
        
        .loteria-modal-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #0A0A0A; z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
        .loteria-modal-container.is-active { opacity: 1; pointer-events: auto; }
        .loteria-close-btn { position: absolute; top: 20px; right: 20px; font-size: 2rem; color: white; background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2010; line-height: 1; }
        #loteria-iframe-container { width: 100%; height: 100%; }
        #loteria-iframe-container iframe { width: 100%; height: 100%; border: none; }

        footer { text-align: center; font-size: 0.9rem; padding: 4rem var(--main-gap); background-color: #111; }
        @media (max-width: 768px) { .content-overlay h1 { font-size: 3rem; } .content-overlay h2 { font-size: 2.5rem; } }
    </style>
</head>
<body>

    <header><div class="header-logo"><a href="#">ARG</a></div></header>

    <main>
        <section class="media-block" id="block-1">
             <div class="background-media"><img src="https://res.cloudinary.com/dahrwkdzd/image/upload/v1756530594/u4597281485_A_vast_minimalist_landscape._The_sea_is_an_almost_03674990-b688-4c55-8480-a7d71d9437c4_3_xooqz9.png" alt="Jardín Digital"></div>
            <div class="content-overlay"><h1>Jardín Digital</h1><p>Una colección de Alan Ruíz Galicia</p></div>
        </section>

        <section class="media-block" id="block-2">
            <div class="background-media"><video src="https://res.cloudinary.com/dahrwkdzd/video/upload/v1756531260/godar01_glnxkl.webm" autoplay loop muted playsinline></video></div>
            <div class="color-overlay overlay-full iridescent-base iridescent-slow-h"></div>
            <div class="content-overlay"><h2>Ecos en las Ruinas</h2><p>Las estrellas susurran historias antiguas, tejiendo destinos en el tapiz del cosmos.</p><button class="btn">Explorar</button></div>
        </section>

        <section class="media-block" id="block-3">
            <div class="background-media"><img src="https://res.cloudinary.com/dahrwkdzd/image/upload/v1756530311/u4597281485_A_tight_cinematic_shot_of_a_womans_mouth._Her_lip_6c85d667-7b45-497b-b310-0b861adb7735_1_urjioq.png" alt="Archivo Sonoro"></div>
            <div class="content-overlay"><h2>Archivo Sonoro</h2><p>Fragmentos que exploran la intersección del arte, la tecnología y el espíritu.</p><button class="btn">Escuchar</button></div>
        </section>
        
        <section class="media-block" id="block-4">
            <div class="background-media"><img src="https://res.cloudinary.com/dahrwkdzd/image/upload/v1756530574/u4597281485_A_chaotic_still_life_on_a_wooden_floor_lit_by_a_h_a157247e-085a-457b-a207-f43933663674_3_or5v4i.png" alt="Lotería"></div>
            <div class="color-overlay overlay-window iridescent-base iridescent-fast-v"></div>
            <div class="content-overlay"><h2>Lotería Tapatía</h2><p>Una reinterpretación digital del clásico juego de mesa.</p>
                <button class="btn" id="open-loteria-btn">Jugar Ahora</button>
            </div>
        </section>
    </main>
    
    <footer><p>&copy; 2025 - ARG. Todos los derechos reservados.</p></footer>
    
    <div id="loteria-modal" class="loteria-modal-container">
        <span id="close-loteria-btn" class="loteria-close-btn">&times;</span>
        <div id="loteria-iframe-container"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CÓDIGO DEL PARALLAX DE REVELACIÓN (SIN CAMBIOS) ---
            const mediaBlocks = document.querySelectorAll('.media-block');
            const windowHeight = window.innerHeight;
            let ticking = false;
            function updateScrollEffects() {
                mediaBlocks.forEach(block => {
                    const rect = block.getBoundingClientRect();
                    const media = block.querySelector('.background-media > *');
                    if (!media) return;
                    if (rect.top < windowHeight && rect.bottom > 0) {
                        const progress = (rect.top + block.offsetHeight) / (windowHeight + block.offsetHeight);
                        const clampedProgress = 1 - Math.max(0, Math.min(1, progress));
                        const travelRange = media.offsetHeight - block.offsetHeight;
                        const translateY = -travelRange * clampedProgress;
                        media.style.transform = `translateY(${translateY}px)`;
                    }
                    if (rect.top < windowHeight * 0.75 && rect.bottom > windowHeight * 0.25) {
                         block.classList.add('is-visible');
                    } else {
                         block.classList.remove('is-visible');
                    }
                });
                ticking = false;
            }
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(updateScrollEffects);
                    ticking = true;
                }
            });
            updateScrollEffects();

            // ======================================================= //
            // --- LÓGICA DEL MODAL CON GESTIÓN DE HISTORIAL (CORREGIDA) --- //
            // ======================================================= //
            const openLoteriaBtn = document.getElementById('open-loteria-btn');
            const closeLoteriaBtn = document.getElementById('close-loteria-btn');
            const loteriaModal = document.getElementById('loteria-modal');
            const iframeContainer = document.getElementById('loteria-iframe-container');
            const loteriaURL = 'https://alter-ias.github.io/arg/loteriatapatiax.html';

            function openLoteria() {
                if (loteriaModal.classList.contains('is-active')) return;

                const iframe = document.createElement('iframe');
                iframe.src = loteriaURL;
                iframeContainer.appendChild(iframe);

                loteriaModal.classList.add('is-active');
                document.body.style.overflow = 'hidden';

                // 1. Añadimos una entrada "falsa" al historial para capturar el botón "atrás"
                history.pushState({ modal: 'loteria' }, '', '#loteria');
            }

            function closeLoteria() {
                if (!loteriaModal.classList.contains('is-active')) return;

                loteriaModal.classList.remove('is-active');
                document.body.style.overflow = '';
                iframeContainer.innerHTML = '';
            }

            openLoteriaBtn.addEventListener('click', openLoteria);
            
            // 2. El botón de cierre ahora utiliza history.back() para que sea consistente
            closeLoteriaBtn.addEventListener('click', () => {
                history.back();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && loteriaModal.classList.contains('is-active')) {
                    history.back();
                }
            });

            // 3. Este listener se activa con history.back() o el botón del navegador
            window.addEventListener('popstate', () => {
                // Si el modal está activo, el evento popstate es la señal para cerrarlo.
                if (loteriaModal.classList.contains('is-active')) {
                    closeLoteria();
                }
            });
        });
    </script>
</body>
</html>
